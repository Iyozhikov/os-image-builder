{
  "variables": {
    "fuel9_iso": "MirantisOpenStack-9.0.iso",
    "fuel9_iso_md5": "07461ba42d5056830dd6f203e8fe9691",
    "rpm_packages": "python-pip vim",
    "disk_size": "82000",
    "build_name": "4vcp",
    "user": "root",
    "password": "r00tme"
  },
  "builders":
  [
      {
      "name": "{{user `build_name`}}",
      "vm_name": "fuel9",
      "iso_url": "{{user `fuel9_iso`}}",
      "iso_checksum": "{{user `fuel9_iso_md5`}}",
      "iso_checksum_type": "md5",
      "http_directory": "http",
      "headless": "true",
      "type": "qemu",
      "format": "qcow2",
      "accelerator": "kvm",
      "disk_size": "{{ user `disk_size`}}",
      "vnc_bind_address": "0.0.0.0",
      "vnc_port_min": "5990",
      "vnc_port_max": "5990",
      "net_device": "virtio",
      "qemuargs":[
        [ "-cpu", "host" ],
        [ "-smp", "cores=2,threads=1,sockets=1" ],
        [ "-m", "2048M" ],
        [ "-device", "virtio-net-pci,netdev=net0,mac=DE:AD:BE:EF:34:47,bus=pci.0,addr=0x3" ],
        [ "-netdev", "tap,ifname=vnet-adm0,id=net0,script=scripts/qemu-ifup_br-adm0,downscript=scripts/qemu-ifdown_br-adm0" ],
        [ "-device", "virtio-net-pci,netdev=net1,mac=DE:AD:BE:EF:34:48,bus=pci.0,addr=0x4" ],
        [ "-netdev", "tap,ifname=vnet-mgm0,id=net1,script=scripts/qemu-ifup_br-mgm0,downscript=scripts/qemu-ifdown_br-mgm0" ],
        [ "-device", "virtio-net-pci,netdev=forward,mac=0A:01:02:03:04:05,bus=pci.0,addr=0x5"],
        [ "-netdev", "user,hostfwd=tcp::{{ .SSHHostPort }}-:22,id=forward"]
      ],
      "boot_wait": "5s",
      "boot_command": [
        "<esc>",
        "<wait>",
        "vmlinuz initrd=initrd.img net.ifnames=0 biosdevname=0 ",
        "inst.repo=cdrom:LABEL=OpenStack_Fuel:/ inst.ks=cdrom:LABEL=OpenStack_Fuel:/ks.cfg ",
        "rd.neednet=1 nameserver=114.114.114.114 nameserver=8.8.8.8 showmenu=no forceformat=yes ",
        "ifname=eth0:DE:AD:BE:EF:34:47 ip=10.20.0.2:::255.255.255.0:fuel.domain.tld:eth0:none ",
        "ifname=eth1:DE:AD:BE:EF:34:48 ip=10.10.11.200::10.10.11.254:255.255.255.0::eth1:none ",
        "<enter>"
      ],

      "ssh_username": "{{user `user`}}",
      "ssh_password": "{{user `password`}}",
      "ssh_wait_timeout": "15m",
      "shutdown_command": "sudo systemctl poweroff"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S bash '{{.Path}}'",
      "environment_vars": [
        "GPG_UID={{user `gpg_uid`}}",
        "RPM_PACKAGES={{user `rpm_packages`}}"
      ],
      "scripts": [
        "scripts/image_fuel9.sh"
      ]
    }
  ]
}
